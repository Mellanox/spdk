job: spdk

registry_host: harbor.mellanox.com
registry_path: /swx-storage/spdk
registry_auth: swx-storage

credentials:
  - {credentialsId: '311997c9-cc1c-4d5d-8ba2-6eb43ba0a06d', usernameVariable: 'REPO_USER', passwordVariable: 'REPO_PASS'}

failFast: false
kubernetes:
  cloud: swx-k8s-spray

volumes:
  - {mountPath: /auto/mtrswgwork, hostPath: /auto/mtrswgwork}

runs_on_dockers:
  - {file: '.ci/Dockerfile.ubuntu20.04', name: 'ubuntu2004ofed53', arch: 'x86_64', tag: '5.3-1.0.0.1'}
  - {file: '.ci/Dockerfile.ubuntu20.04', name: 'ubuntu2004ofed53', arch: 'aarch64', tag: '5.3-1.0.0.1'}
  - {file: '.ci/Dockerfile.centos7.9.2009', name: 'centos79ofed53', arch: 'x86_64', tag: '5.3-1.0.0.1'}
  - {file: '.ci/Dockerfile.centos7.9.2009', name: 'centos79ofed53', arch: 'aarch64', tag: '5.3-1.0.0.1'}

steps:

  - name: Build distro package
    run: |
      if [ -e /etc/redhat-release ]; then
        .ci/build_rpm.sh
      elif [ -e /etc/debian_version ]; then
        .ci/build_deb.sh
      fi
